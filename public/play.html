<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cool CS RPG</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link href="./style.css" rel="stylesheet"/>
  </head>
  <body>
    
    <script defer
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"
  ></script>

    <header>
      <nav class="navbar navbar-expand navbar-dark">
        <a class="navbar-brand" href="index.html">Cool CS RPG - </a>
        <ul class="navbar-nav navbar-right">
          <li class="nav-item">
            <a class="nav-link" href="play.html">Play</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="rules.html">Rules</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html">Logout</a>
          </li>
        </div>
      </nav>
    </header>
    <main>
      <div class="game_images_and_log_and_username_container">
        <div class="game_images_and_buttons_and_username_container">
          <div class="game_images_and_buttons_container">
            <div class="game_images_hearts_container" id="health_container">
              <div class="game_images_hearts_container_internal player_hearts" id="player_health">
                <img src="images/heart_filled.png" class="heart_image">
                <img src="images/heart_filled.png" class="heart_image">
                <img src="images/heart_filled.png" class="heart_image">
              </div>

              <div class="game_images_hearts_container_internal" id="enemy_health">
                <img src="images/heart_filled.png" class="heart_image">
                <img src="images/heart_filled.png" class="heart_image">
                <img src="images/heart_filled.png" class="heart_image">
                <img src="images/heart_filled.png" class="heart_image">
                <img src="images/heart_filled.png" class="heart_image">
              </div>
            </div>
            <div class="game_images_container_internal">
              <img src="images/hero.png" class="hero_image">
              <img src="images/monster.jpg" id="monster_image" class="monster_image">
            </div>
            <div class="game_buttons_container">
              <button type="button" id="game_button_fight" class="game_button_fight btn btn-primary btn-lg">Fight!</button>
              <div class="game_buttons_container_internal">
                <button type="button" id="game_button_heal" class="game_button_heal btn btn-success"><div id="healing_display">Heal! 0</div></button>
                <button type="button" id="game_button_run" class="game_button_run btn btn-secondary btn-sm"><div id="run_display">Run!</div></button>
              </div>
            </div>
          </div>
          <div class="username_and_score_container">
            <div class="username_and_score_container_internal" id="username_and_score">
            </div>
          </div>
        </div>
        <div class="game_log_container" id="game_log_container">
        </div>
      </div>
      <script src="game_buttons.js"></script>
      <script>
        function update_username_display() {
          const local_username = localStorage.getItem("username");
          const username_display = document.createElement("h3");
          username_display.id = "username_display";
          username_display.textContent = local_username;
          const username_parent_obj = document.querySelector("#username_and_score");
          username_parent_obj.appendChild(username_display);
        }
        

        // TODO: refactor the two functions below into one function
        function update_score_display() {
          const local_username = localStorage.getItem("username");
          const score_access_string = "score" + local_username;
          const local_score = localStorage.getItem(score_access_string);
          const score_display = document.createElement("h5");
          score_display.id = "score_display";
          if (local_score != null) {
            score_display.textContent = local_score;
          } else {
            score_display.textContent = "0";
          }
          const score_parent_object = document.querySelector("#username_and_score");
          let existing_score_display = document.getElementById("score_display");
          if (existing_score_display != null) {
            score_parent_object.removeChild(existing_score_display);
          }
          score_parent_object.appendChild(score_display);
        }
        function update_healing_display() {
          const local_username = localStorage.getItem("username");
          const healing_access_string = "healing" + local_username;
          const local_healing = localStorage.getItem(healing_access_string);
          const healing_display = document.createElement("div");
          
          healing_display.id = "healing_display";
          if (local_healing != null) {
            healing_display.textContent = "Heal! " + local_healing;
          } else {
            healing_display.textContent = "Heal! 0";
          }
          const healing_parent_object = document.querySelector("#game_button_heal");
          let existing_healing_display = document.getElementById("healing_display");
          if (existing_healing_display != null) {
            healing_parent_object.removeChild(existing_healing_display);
          }
          healing_parent_object.appendChild(healing_display);
        }
        function update_run_display() {
          const run_display = document.createElement("div");
          
          run_display.id = "run_display";
          if (run_cost != undefined) {
            run_display.textContent = "Run! (" + String(run_cost) + "g)";
          } else {
            run_display.textContent = "Run!";
          }
          const run_parent_object = document.querySelector("#game_button_run");
          let existing_run_display = document.getElementById("run_display");
          if (existing_run_display != null) {
            run_parent_object.removeChild(existing_run_display);
          }
          run_parent_object.appendChild(run_display);
        }
        function update_health_display() {
          const local_username = localStorage.getItem("username");
          const health_access_string = "health" + local_username;
          const enemy_health_access_string = "enemy_health" + local_username;
          const local_health = localStorage.getItem(health_access_string);
          const local_enemy_health = localStorage.getItem(enemy_health_access_string);
          const local_enemy_health_max = localStorage.getItem(enemy_health_access_string + "max");
          const health_display = document.createElement("div");
          const enemy_health_display = document.createElement("div");
          
          health_display.id = "player_health";
          health_display.setAttribute("class", "game_images_hearts_container_internal player_hearts");
          var health_filled_to_display = local_health;
          var health_empty_to_display = 3-local_health;
          for (var i = 0; i < health_filled_to_display; i++) {
            var image = document.createElement("img");
            image.src = "images/heart_filled.png";
            image.setAttribute("class", "heart_image");
            health_display.appendChild(image);
          }
          for (var i = 0; i < health_empty_to_display; i++) {
            var image = document.createElement("img");
            image.src = "images/heart_outline.png";
            image.setAttribute("class", "heart_image");
            health_display.appendChild(image);
          }

          const health_parent_object = document.querySelector("#health_container");
          let existing_health_display = document.getElementById("player_health");
          if (existing_health_display != null) {
            health_parent_object.removeChild(existing_health_display);
          }
          health_parent_object.appendChild(health_display);


          enemy_health_display.setAttribute("class", "game_images_hearts_container_internal");
          enemy_health_display.setAttribute("id", "enemy_health");
          var health_filled_to_display = local_enemy_health;
          var health_empty_to_display = local_enemy_health_max-local_enemy_health;
          for (var i = 0; i < health_empty_to_display; i++) {
            var image = document.createElement("img");
            image.src = "images/heart_outline.png";
            image.setAttribute("class", "heart_image");
            enemy_health_display.appendChild(image);
          }
          for (var i = 0; i < health_filled_to_display; i++) {
            var image = document.createElement("img");
            image.src = "images/heart_filled.png";
            image.setAttribute("class", "heart_image");
            enemy_health_display.appendChild(image);
          }

          let existing_enemy_health_display = document.getElementById("enemy_health");
          if (existing_enemy_health_display != null) {
            health_parent_object.removeChild(existing_enemy_health_display);
          }
          health_parent_object.appendChild(enemy_health_display);

        }
        function update_log_display(message) {
          const log_parent = document.getElementById("game_log_container");
          const log_message_element = document.createElement("p");
          log_message_element.id = "log" + String(log_count++);
          if (window.innerWidth > less_log_screen_width_limit && log_count > log_max) {
            let log_old = document.getElementById("log" + String(log_count - log_max - 1));
            log_parent.removeChild(log_old);
            let log_second_old = document.getElementById("log" + String(log_count - log_max));
            log_second_old.setAttribute("style", "opacity: 20%")
          } else if (window.innerWidth <= less_log_screen_width_limit && log_count > less_log_max) {
            let log_old = document.getElementById("log" + String(log_count - less_log_max - 1));
            log_parent.removeChild(log_old);
            let log_second_old = document.getElementById("log" + String(log_count - less_log_max));
            log_second_old.setAttribute("style", "opacity: 20%")
          }
          log_message_element.textContent = message;
          log_parent.appendChild(log_message_element);
        }
        
        update_username_display();
        update_score_display();
        update_healing_display();
        update_health_display();
        update_run_display();
        const log_max = 8;
        const less_log_max = 4;
        const less_log_screen_width_limit = 600;
        let log_count = 0;
        setTimeout(() => update_log_display("karen321 defeated a landsquid and earned 304g!"), 5000);
        setTimeout(() => update_log_display("karen321 was defeated by a landsquid and lost 2000g!"), 10000);
      </script>
    </main>
    <footer>
      <p>by Alex Snow - <a href="https://github.com/acsnow99/startup">GitHub</a></p>
    </footer>

  </body>
